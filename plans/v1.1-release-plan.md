# ArtisanPack UI Media Library v1.1 Release Plan

**Target Version:** 1.1.0
**Target Release Date:** TBD
**Last Updated:** January 19, 2026
**Status:** Planning

---

## Overview

Version 1.1 introduces enhanced integration with Keystone CMS, compatibility with `artisanpack-ui/livewire-ui-components` v2.0, and support for Livewire 4 features while maintaining backward compatibility with Livewire 3.

### Key Goals

1. **Keystone CMS Integration** - Provide a seamless media selection experience for the visual editor
2. **livewire-ui-components v2.0 Compatibility** - Leverage new UI features while keeping them customizable
3. **Livewire 4 Support** - Implement `wire:stream` for real-time upload progress (with Livewire 3 fallback)
4. **Developer Customization** - Ensure all new features can be opted into/out of via configuration

---

## Release Milestones

### Phase 1: Foundation & Compatibility (Week 1-2)

| Task | Issue |
|------|-------|
| Update dependencies for livewire-ui-components v2.0 | [#42](https://gitlab.com/jacob-martella-web-design/artisanpack-ui/artisanpack-ui-media-library/-/issues/42) |
| Add Livewire version detection helper | [#43](https://gitlab.com/jacob-martella-web-design/artisanpack-ui/artisanpack-ui-media-library/-/issues/43) |
| Set up feature flags in config/media.php | [#44](https://gitlab.com/jacob-martella-web-design/artisanpack-ui/artisanpack-ui-media-library/-/issues/44) |

### Phase 2: Livewire 4 Features (Week 3-4)

| Task | Issue |
|------|-------|
| Implement `wire:stream` for upload progress | [#45](https://gitlab.com/jacob-martella-web-design/artisanpack-ui/artisanpack-ui-media-library/-/issues/45) |
| Add graceful degradation for Livewire 3 | [#46](https://gitlab.com/jacob-martella-web-design/artisanpack-ui/artisanpack-ui-media-library/-/issues/46) |

### Phase 3: UI Enhancements (Week 5-6)

| Task | Issue |
|------|-------|
| Integrate glass effects (opt-in) | [#47](https://gitlab.com/jacob-martella-web-design/artisanpack-ui/artisanpack-ui-media-library/-/issues/47) |
| Add media statistics dashboard | [#48](https://gitlab.com/jacob-martella-web-design/artisanpack-ui/artisanpack-ui-media-library/-/issues/48) |
| Implement table export functionality | [#49](https://gitlab.com/jacob-martella-web-design/artisanpack-ui/artisanpack-ui-media-library/-/issues/49) |

### Phase 4: Keystone CMS Integration (Week 7-8)

| Task | Issue |
|------|-------|
| Create standalone MediaPicker component | [#50](https://gitlab.com/jacob-martella-web-design/artisanpack-ui/artisanpack-ui-media-library/-/issues/50) |
| Enhance MediaModal for visual editor | [#51](https://gitlab.com/jacob-martella-web-design/artisanpack-ui/artisanpack-ui-media-library/-/issues/51) |
| Add block content integration helpers | [#52](https://gitlab.com/jacob-martella-web-design/artisanpack-ui/artisanpack-ui-media-library/-/issues/52) |

### Phase 5: Testing & Documentation (Week 9-10)

| Task | Issue |
|------|-------|
| Write tests for new features | [#53](https://gitlab.com/jacob-martella-web-design/artisanpack-ui/artisanpack-ui-media-library/-/issues/53) |
| Update documentation | [#54](https://gitlab.com/jacob-martella-web-design/artisanpack-ui/artisanpack-ui-media-library/-/issues/54) |
| Create migration guide | [#55](https://gitlab.com/jacob-martella-web-design/artisanpack-ui/artisanpack-ui-media-library/-/issues/55) |
| Beta release and testing | — |

---

## Detailed Feature Specifications

### 1. Livewire 4 Features: wire:stream Upload Progress

**Objective:** Provide real-time upload progress streaming using Livewire 4's `wire:stream` directive while maintaining Livewire 3 compatibility.

#### Implementation Details

**New Files:**
- `src/Traits/StreamableUpload.php` - Trait for streaming upload progress
- `src/Helpers/LivewireHelper.php` - Livewire version detection

**Modified Files:**
- `src/Livewire/Components/MediaUpload.php` - Add streaming support
- `resources/views/livewire/components/media-upload.blade.php` - Stream UI

#### Feature Behavior

**Livewire 4+:**
```php
// MediaUpload.php
public function uploadWithStream($file)
{
    $this->stream(
        to: 'upload-progress',
        content: json_encode(['progress' => 0, 'file' => $file->getClientOriginalName()]),
    );

    // Process upload with progress streaming
    foreach ($this->processUploadChunks($file) as $progress) {
        $this->stream(
            to: 'upload-progress',
            content: json_encode(['progress' => $progress]),
        );
    }
}
```

**Livewire 3 Fallback:**
```php
// Uses existing wire:loading and periodic polling for progress
public function uploadWithPolling($file)
{
    $this->uploadProgress = 0;
    // Standard upload with property updates
}
```

#### Configuration

```php
// config/media.php
'features' => [
    'streaming_upload' => env('MEDIA_STREAMING_UPLOAD', true),
    'streaming_fallback_interval' => 500, // ms for Livewire 3 polling
],
```

---

### 2. livewire-ui-components v2.0 Integration

#### 2.1 Glass Effects for Media Overlays

**Objective:** Apply frosted glass effects to media cards, modals, and overlays using the new GlassHelper utility.

**Implementation:**
- Use `glass-frosted-light` preset for media card overlays (title, metadata)
- Use `glass-blur` for modal backdrops
- All glass effects are opt-in via configuration

**Configuration:**
```php
// config/media.php
'ui' => [
    'glass_effects' => [
        'enabled' => env('MEDIA_GLASS_EFFECTS', true),
        'card_overlay' => 'glass-frosted-light',
        'modal_backdrop' => 'glass-blur',
        'custom_presets' => [], // Allow custom presets
    ],
],
```

**Usage in Views:**
```blade
{{-- resources/views/livewire/components/media-item.blade.php --}}
@if(config('artisanpack.media.ui.glass_effects.enabled'))
    <div class="{{ config('artisanpack.media.ui.glass_effects.card_overlay') }}">
        <!-- Media metadata overlay -->
    </div>
@else
    <div class="bg-black/50">
        <!-- Fallback solid overlay -->
    </div>
@endif
```

#### 2.2 Media Statistics Dashboard

**Objective:** Provide a media statistics dashboard using KpiCard, WidgetGrid, and Sparkline components.

**New Files:**
- `src/Livewire/Components/MediaStats.php` - Stats dashboard component
- `resources/views/livewire/components/media-stats.blade.php` - Dashboard view

**Statistics Tracked:**
- Total media count (with sparkline showing daily uploads)
- Storage usage (with trend indicator)
- Media by type breakdown
- Top folders by media count
- Recent uploads activity

**Implementation:**
```php
// MediaStats.php
class MediaStats extends Component
{
    public function mount(): void
    {
        // Only load if KpiCard component is available
        if (!config('artisanpack.media.ui.stats_dashboard.enabled')) {
            return;
        }
    }

    #[Computed]
    public function statistics(): array
    {
        return [
            'total_media' => Media::count(),
            'total_storage' => $this->formatBytes(Media::sum('file_size')),
            'by_type' => Media::selectRaw('SUBSTRING_INDEX(mime_type, "/", 1) as type, COUNT(*) as count')
                ->groupBy('type')
                ->pluck('count', 'type'),
            'uploads_sparkline' => $this->getDailyUploadsSparkline(),
        ];
    }
}
```

**Configuration:**
```php
// config/media.php
'ui' => [
    'stats_dashboard' => [
        'enabled' => env('MEDIA_STATS_DASHBOARD', true),
        'sparkline_days' => 14,
        'show_storage_usage' => true,
        'show_type_breakdown' => true,
    ],
],
```

#### 2.3 Table Export for Media Lists

**Objective:** Add CSV, XLSX, and PDF export functionality for media inventory using the Table component's export feature.

**Implementation:**
- Use `WithTableExport` trait in MediaLibrary component
- Add export button to media list toolbar
- Support filtered exports (export what's currently visible)

**Modified Files:**
- `src/Livewire/Components/MediaLibrary.php` - Add WithTableExport trait
- `resources/views/livewire/pages/media-library.blade.php` - Add export UI

**Code Changes:**
```php
// MediaLibrary.php
use ArtisanPack\LivewireUiComponents\Traits\WithTableExport;

class MediaLibrary extends Component
{
    use WithTableExport;

    public function getTableExportData(): array
    {
        return [
            'headers' => [
                ['key' => 'id', 'label' => 'ID'],
                ['key' => 'title', 'label' => 'Title'],
                ['key' => 'file_name', 'label' => 'File Name'],
                ['key' => 'mime_type', 'label' => 'Type'],
                ['key' => 'file_size', 'label' => 'Size'],
                ['key' => 'created_at', 'label' => 'Uploaded'],
            ],
            'rows' => $this->getFilteredMedia()->map(fn($m) => [
                'id' => $m->id,
                'title' => $m->title,
                'file_name' => $m->file_name,
                'mime_type' => $m->mime_type,
                'file_size' => $m->humanFileSize(),
                'created_at' => $m->created_at->format('Y-m-d H:i'),
            ])->toArray(),
        ];
    }
}
```

**Configuration:**
```php
// config/media.php
'ui' => [
    'table_export' => [
        'enabled' => env('MEDIA_TABLE_EXPORT', true),
        'formats' => ['csv', 'xlsx', 'pdf'],
        'filename_prefix' => 'media-export',
    ],
],
```

---

### 3. Keystone CMS Integration

#### 3.1 Standalone MediaPicker Component

**Objective:** Create a lightweight, embeddable media picker component for the visual editor's block content editing.

**New Files:**
- `src/Livewire/Components/MediaPicker.php` - Standalone picker component
- `resources/views/livewire/components/media-picker.blade.php` - Picker view
- `src/Blade/Components/MediaPickerButton.php` - Blade component for trigger

**Component Design:**

```php
// MediaPicker.php
class MediaPicker extends Component
{
    // Minimal props for embedding in visual editor
    public bool $isOpen = false;
    public ?int $selectedMediaId = null;
    public string $context = '';
    public string $acceptTypes = 'image/*'; // Filter by type
    public bool $showUpload = true;

    // Lightweight - no pagination by default, uses infinite scroll
    public int $loadCount = 20;

    #[On('open-media-picker')]
    public function open(string $context = '', ?string $acceptTypes = null): void
    {
        if ($context === '' || $context === $this->context) {
            $this->isOpen = true;
            if ($acceptTypes) {
                $this->acceptTypes = $acceptTypes;
            }
        }
    }

    public function select(int $mediaId): void
    {
        $media = Media::find($mediaId);

        // Dispatch event for visual editor integration
        $this->dispatch('media-picked', [
            'media' => $media->toArray(),
            'context' => $this->context,
        ]);

        $this->close();
    }
}
```

**Blade Component Usage (Visual Editor):**

```blade
{{-- In visual editor block editing --}}
<x-media-picker-button
    context="block-{{ $block->id }}-image"
    accept="image/*"
    :selected="$content['media_id'] ?? null"
/>

{{-- Or directly --}}
<livewire:media::media-picker
    context="hero-image"
    accept-types="image/*"
/>
```

**Events Emitted:**
- `media-picked` - When media is selected (includes full media object)
- `media-picker-opened` - When picker opens
- `media-picker-closed` - When picker closes

#### 3.2 Enhanced MediaModal for Visual Editor

**Objective:** Improve the existing MediaModal with visual editor-specific enhancements.

**Enhancements:**
- Quick upload with immediate selection
- Drag-and-drop upload zone
- Recently used media section
- Keyboard navigation (arrow keys, enter to select)
- Responsive sizing for inline editing

**Modified Files:**
- `src/Livewire/Components/MediaModal.php`
- `resources/views/livewire/components/media-modal.blade.php`

**New Features:**

```php
// MediaModal.php additions
public bool $inlineMode = false; // Compact mode for visual editor
public array $recentlyUsed = [];
public bool $quickUploadSelect = true; // Auto-select after upload

public function mount(/* existing params */, bool $inlineMode = false): void
{
    $this->inlineMode = $inlineMode;
    $this->loadRecentlyUsed();
}

protected function loadRecentlyUsed(): void
{
    // Load from session or user preferences
    $this->recentlyUsed = session('media.recently_used', []);
}

public function trackUsage(int $mediaId): void
{
    $recent = session('media.recently_used', []);
    array_unshift($recent, $mediaId);
    $recent = array_unique(array_slice($recent, 0, 10));
    session(['media.recently_used' => $recent]);
}
```

#### 3.3 Block Content Integration Helpers

**Objective:** Provide helper functions for visual editor block integration.

**New Files:**
- `src/Helpers/BlockMediaHelper.php` - Helper for block media operations

**Helper Functions:**

```php
// BlockMediaHelper.php
class BlockMediaHelper
{
    /**
     * Get media URL for block content with size optimization.
     */
    public static function getBlockMediaUrl(?int $mediaId, string $size = 'medium'): ?string
    {
        if (!$mediaId) {
            return null;
        }

        $media = Media::find($mediaId);
        return $media?->imageUrl($size);
    }

    /**
     * Get media object formatted for block content schema.
     */
    public static function getBlockMediaData(?int $mediaId): ?array
    {
        if (!$mediaId) {
            return null;
        }

        $media = Media::find($mediaId);
        if (!$media) {
            return null;
        }

        return [
            'id' => $media->id,
            'url' => $media->url(),
            'thumbnail' => $media->imageUrl('thumbnail'),
            'medium' => $media->imageUrl('medium'),
            'large' => $media->imageUrl('large'),
            'alt' => $media->alt_text,
            'title' => $media->title,
            'mime_type' => $media->mime_type,
        ];
    }

    /**
     * Validate media for block type requirements.
     */
    public static function validateForBlock(int $mediaId, string $blockType): bool
    {
        $media = Media::find($mediaId);
        if (!$media) {
            return false;
        }

        $requirements = config("artisanpack.media.block_requirements.{$blockType}", []);

        // Check mime type requirements
        if (!empty($requirements['mime_types'])) {
            $matches = false;
            foreach ($requirements['mime_types'] as $pattern) {
                if (fnmatch($pattern, $media->mime_type)) {
                    $matches = true;
                    break;
                }
            }
            if (!$matches) {
                return false;
            }
        }

        return true;
    }
}
```

**Helper Function (in helpers.php):**

```php
/**
 * Get media data formatted for visual editor blocks.
 */
function apBlockMedia(?int $mediaId, string $size = 'medium'): ?array
{
    return \ArtisanPackUI\MediaLibrary\Helpers\BlockMediaHelper::getBlockMediaData($mediaId);
}
```

---

### 4. Configuration Updates

**Updated config/media.php:**

```php
<?php

return [
    // Existing configuration...

    /*
    |--------------------------------------------------------------------------
    | Feature Flags
    |--------------------------------------------------------------------------
    |
    | Enable or disable specific features. Useful for gradual rollout
    | or disabling features that conflict with custom implementations.
    |
    */
    'features' => [
        // Livewire 4 streaming upload progress
        'streaming_upload' => env('MEDIA_STREAMING_UPLOAD', true),
        'streaming_fallback_interval' => 500,
    ],

    /*
    |--------------------------------------------------------------------------
    | UI Configuration
    |--------------------------------------------------------------------------
    |
    | Configure UI enhancements from livewire-ui-components v2.0.
    | All features can be disabled if you prefer custom implementations.
    |
    */
    'ui' => [
        // Glass effects for media overlays
        'glass_effects' => [
            'enabled' => env('MEDIA_GLASS_EFFECTS', true),
            'card_overlay' => 'glass-frosted-light',
            'modal_backdrop' => 'glass-blur',
            'custom_presets' => [],
        ],

        // Media statistics dashboard
        'stats_dashboard' => [
            'enabled' => env('MEDIA_STATS_DASHBOARD', true),
            'sparkline_days' => 14,
            'show_storage_usage' => true,
            'show_type_breakdown' => true,
        ],

        // Table export functionality
        'table_export' => [
            'enabled' => env('MEDIA_TABLE_EXPORT', true),
            'formats' => ['csv', 'xlsx', 'pdf'],
            'filename_prefix' => 'media-export',
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Visual Editor Integration
    |--------------------------------------------------------------------------
    |
    | Settings for Keystone CMS visual editor integration.
    |
    */
    'visual_editor' => [
        // Track recently used media for quick access
        'track_recently_used' => true,
        'recently_used_limit' => 10,

        // Quick upload behavior
        'quick_upload_select' => true,

        // MediaPicker default settings
        'picker' => [
            'default_load_count' => 20,
            'show_upload' => true,
        ],
    ],

    /*
    |--------------------------------------------------------------------------
    | Block Requirements
    |--------------------------------------------------------------------------
    |
    | Define media requirements for different visual editor block types.
    |
    */
    'block_requirements' => [
        'image' => [
            'mime_types' => ['image/*'],
        ],
        'video' => [
            'mime_types' => ['video/*'],
        ],
        'hero_image' => [
            'mime_types' => ['image/*'],
            'min_width' => 1200,
        ],
        'gallery' => [
            'mime_types' => ['image/*'],
        ],
    ],
];
```

---

### 5. Dependency Updates

**composer.json changes:**

```json
{
    "require": {
        "artisanpack-ui/livewire-ui-components": "^2.0",
        "livewire/livewire": "^3.6|^4.0"
    },
    "suggest": {
        "phpoffice/phpspreadsheet": "Required for XLSX export in media table (^1.29 or ^2.0)",
        "barryvdh/laravel-dompdf": "Required for PDF export in media table (^2.0 or ^3.0)"
    }
}
```

---

### 6. Breaking Changes

**None expected.** All new features are additive and opt-in via configuration. Existing functionality remains unchanged.

---

### 7. Migration Guide

#### For Existing Users

1. Update composer dependencies:
   ```bash
   composer update artisanpack-ui/media-library
   ```

2. Publish updated configuration (optional):
   ```bash
   php artisan vendor:publish --tag=artisanpack-package-config --force
   ```

3. Review new configuration options in `config/artisanpack/media.php`

4. If using Livewire 4, streaming upload will be automatically enabled

#### For Keystone CMS Integration

1. Use `MediaPicker` component in visual editor blocks:
   ```blade
   <livewire:media::media-picker context="block-image" />
   ```

2. Listen for `media-picked` events in your block editor:
   ```javascript
   Livewire.on('media-picked', (data) => {
       // Update block content with selected media
       updateBlockMedia(data.context, data.media);
   });
   ```

---

### 8. Testing Plan

#### Unit Tests

- [ ] LivewireHelper version detection
- [ ] BlockMediaHelper methods
- [ ] Configuration merging with new options
- [ ] Export data formatting

#### Feature Tests

- [ ] MediaPicker component - open/close/select
- [ ] MediaModal inline mode
- [ ] MediaStats computed properties
- [ ] Table export (CSV, XLSX, PDF)
- [ ] Streaming upload (Livewire 4)
- [ ] Polling fallback (Livewire 3)

#### Integration Tests

- [ ] Visual editor block integration
- [ ] Event dispatch and handling
- [ ] Configuration flag behavior

---

### 9. Documentation Updates

- [ ] Update README.md with new features
- [ ] Add Keystone CMS integration guide
- [ ] Document configuration options
- [ ] Add visual editor examples
- [ ] Update CHANGELOG.md

---

### 10. Timeline

| Phase | Description | Duration | Status |
|-------|-------------|----------|--------|
| Phase 1 | Foundation & Compatibility | 2 weeks | ⏳ Not Started |
| Phase 2 | Livewire 4 Features | 2 weeks | ⏳ Not Started |
| Phase 3 | UI Enhancements | 2 weeks | ⏳ Not Started |
| Phase 4 | Keystone CMS Integration | 2 weeks | ⏳ Not Started |
| Phase 5 | Testing & Documentation | 2 weeks | ⏳ Not Started |

**Estimated Total:** 10 weeks

---

## Open Questions

1. **MediaPicker infinite scroll implementation** - Should we use wire:intersect (Livewire 4) or a third-party solution for Livewire 3 compatibility?

2. **Stats dashboard location** - Should MediaStats be a standalone page, a component within MediaLibrary, or both?

3. **Export file storage** - Should exported files be stored temporarily or streamed directly to download?

---

## Related Documents

- [Keystone CMS Package Specifications](/Users/jacobmartella/Herd/artisanpack-ui/plans/04-package-specifications.md)
- [Visual Editor Spec](/Users/jacobmartella/Herd/artisanpack-ui/plans/03-visual-editor-spec.md)
- [livewire-ui-components CHANGELOG](/Users/jacobmartella/Desktop/ArtisanPack UI Packages/livewire-ui-components/CHANGELOG.md)

---

*This plan is subject to change based on development progress and feedback.*
